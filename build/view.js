!function(){"use strict";document.querySelectorAll(".wp-block-telex-block-meeting-manager").forEach(function(t){const e=t.dataset.blockId,n=t.querySelector(".countdown-timer"),i=t.querySelector(".meeting-datetime"),o=t.querySelector(".subscription-form"),a=t.querySelector(".jitsi-container"),s=t.querySelector(".meeting-manager-jitsi");let r=null,c={},l=null;o&&o.addEventListener("submit",function(n){n.preventDefault();const i=o.querySelector('input[type="email"]'),a=o.querySelector('input[name="join_list"]'),s=o.querySelector(".subscribe-button"),r=t.querySelector(".subscription-message"),c=i.value,l=!!a&&a.checked;s.disabled=!0,s.textContent="Subscribing...",fetch("/wp-json/meeting-manager/v1/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,block_id:e,join_list:l})}).then(t=>t.json()).then(t=>{if(!t.success)throw new Error(t.message||"Subscription failed");r&&(r.className="subscription-message success",r.textContent="Successfully subscribed! You will receive email notifications.",r.style.display="block"),o.reset(),"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(function(t){"granted"===t&&new Notification("Notifications Enabled!",{body:"You will receive notifications when meetings start."})})}).catch(t=>{r&&(r.className="subscription-message error",r.textContent="Error: "+t.message,r.style.display="block")}).finally(()=>{s.disabled=!1,s.textContent="Subscribe"})}),fetch(`/wp-json/meeting-manager/v1/next-meeting?block_id=${e}`).then(t=>t.json()).then(o=>{o.next_meeting&&(r=new Date(o.next_meeting),c=o,function(){if(i&&r){const t={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",timeZoneName:"short"},e=r.toLocaleString("en-US",t);i.textContent=`Meeting starts: ${e}`}}(),function(){function i(){const i=new Date,o=r-i;if(o<=0)return void async function(){l&&clearInterval(l);const n=t.querySelector(".meeting-manager-countdown"),i=t.querySelector(".meeting-manager-subscription");if(n&&(n.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="block"),"jaas"===c.jitsi_provider)try{const t=window.meetingManagerUserData?.userName||"Guest",n=await fetch("/wp-json/meeting-manager/v1/jaas-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({block_id:e,user_name:t||"Guest"})}),i=await n.json();if(!i.jwt)throw new Error("Failed to get JWT token");{const t=`https://8x8.vc/${i.app_id}/${i.room}?jwt=${i.jwt}`;a&&(a.innerHTML=`\n\t\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\t\tsrc="${t}"\n\t\t\t\t\t\t\t\t\tallow="camera; microphone; fullscreen; display-capture; autoplay"\n\t\t\t\t\t\t\t\t\tallowfullscreen\n\t\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t\t`)}}catch(t){console.error("Error initializing JaaS meeting:",t),a&&(a.innerHTML='<p style="color: red; padding: 2rem; text-align: center;">Error loading meeting. Please check your JaaS configuration.</p>')}else{const t=`https://${c.jitsi_domain}/${c.jitsi_room}`;a&&(a.innerHTML=`\n\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\tsrc="${t}"\n\t\t\t\t\t\t\tallow="camera; microphone; fullscreen; display-capture; autoplay"\n\t\t\t\t\t\t\tallowfullscreen\n\t\t\t\t\t\t></iframe>\n\t\t\t\t\t`)}"Notification"in window&&"granted"===Notification.permission&&new Notification("Meeting Started!",{body:"Your meeting is now live. Join now!",icon:"/wp-content/plugins/meeting-manager/icon.png"})}();const u=Math.floor(o/864e5),d=Math.floor(o%864e5/36e5),m=Math.floor(o%36e5/6e4),p=Math.floor(o%6e4/1e3);n&&(n.innerHTML=`\n\t\t\t\t\t\t<div class="countdown-unit">\n\t\t\t\t\t\t\t<span class="countdown-value">${u}</span>\n\t\t\t\t\t\t\t<span class="countdown-label">Days</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="countdown-unit">\n\t\t\t\t\t\t\t<span class="countdown-value">${d}</span>\n\t\t\t\t\t\t\t<span class="countdown-label">Hours</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="countdown-unit">\n\t\t\t\t\t\t\t<span class="countdown-value">${m}</span>\n\t\t\t\t\t\t\t<span class="countdown-label">Minutes</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="countdown-unit">\n\t\t\t\t\t\t\t<span class="countdown-value">${p}</span>\n\t\t\t\t\t\t\t<span class="countdown-label">Seconds</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)}l&&clearInterval(l),i(),l=setInterval(i,1e3)}())}).catch(t=>{console.error("Error fetching next meeting:",t)})})}();